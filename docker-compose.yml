services:

  # -------------------- PostgreSQL Database --------------------
  db:
    image: postgres:latest               # Official Postgres image
    ports:
      - "5432:5432"                      # HostPort:ContainerPort
    restart: always                      # Auto restart if container stops
    environment:
      POSTGRES_USER: postgres            # DB username
      POSTGRES_PASSWORD: changemeinprod! # DB password (never use in prod)
      POSTGRES_DB: mydb                  # Database to auto-create on startup

  # -------------------- Adminer (DB UI Tool) --------------------
  adminer:
    image: adminer:latest                # Lightweight DB management UI
    restart: always
    ports:
      - "8888:8080"                      # Access UI via localhost:8888

  # -------------------- Keycloak (IAM / SSO Auth Server) --------------------
  keycloak:
    image: quay.io/keycloak/keycloak:latest
    ports:
      - "9090:8080"                      # Access Keycloak via localhost:9090
    environment:
      KEYCLOAK_ADMIN: admin              # Admin username
      KEYCLOAK_ADMIN_PASSWORD: admin     # Admin password (change in prod)
    volumes:
      - keycloak-data:/opt/keycloak/data # Persist Keycloak user/realm data
    command:
      - start-dev                         # Start Keycloak in dev mode
      - --db=dev-file                      # Use embedded DB (dev only)

# -------------------- Persistent Volume --------------------
volumes:
  keycloak-data:
    driver: local                         # Local volume driver
